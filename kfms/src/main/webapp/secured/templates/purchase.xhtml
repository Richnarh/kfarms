<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">  

    <h:body>
        <ui:composition template="../templatesUI.xhtml">
            <ui:define name="pageTitle">
                #{msg.purchases}
            </ui:define>

            <ui:define name="pageContent">
                <h:panelGroup id="mainPanel">

                    <h:panelGroup rendered="#{purchaseController.formView.listView}">
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-lg-12">
                                <h:form style="margin-bottom: 5px;">

                                    <span>From Date: </span>
                                    <p:datePicker 
                                        pattern="#{msg.formatted_date}" 
                                        monthNavigator="true" yearNavigator="true" />

                                    <span>To Date:</span>
                                    <p:datePicker 
                                        pattern="#{msg.formatted_date}" 
                                        monthNavigator="true" yearNavigator="true" />

                                    <p:commandButton styleClass="kbtn-primary ml-2" update=":mainPanel"
                                                     value="#{msg.load}"/>

                                    <div class="float-right">
                                        <p:commandButton value="#{msg.add_new} #{msg.purchases}" styleClass="kbtn-primary"
                                                         icon="fa fa-plus-circle" update=":mainPanel"
                                                         action="#{purchaseController.initPurchase()}"/>

                                    </div>
                                </h:form>      
                            </div>
                        </div>

                        <h:form>
                            <p:dataTable id="purchaseTbl" value="#{purchaseController.purchaseList}" var="purchase"
                                         paginator="true" paginatorPosition="bottom" rows="15">

                                <p:column headerText="#{msg.date}">
                                    <h:outputText value="#{purchase.receivedDate}">
                                        <f:convertDateTime pattern="#{msg.formatted_date}" type="localDate" />
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Type" >
                                    #{purchase.purchaseType}
                                </p:column>

                                <p:column headerText="#{msg.receipt_no}">
                                    #{purchase.receiptNo}
                                </p:column>

                                <p:column headerText="#{msg.customer}">
                                    #{purchase.customer.customerName}
                                </p:column>

                                <p:column headerText="#{msg.note}">
                                    #{purchase.note}
                                </p:column>
                                
                                <p:column headerText="#{msg.total_amount}" styleClass="text-right">
                                    <h:outputText value="#{purchase.totalAmount}">
                                        <f:convertNumber pattern="#{msg.money_pattern}" />
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="#{msg.action}">
                                    <p:menuButton value="#{msg.manage}" styleClass="kbtn-primary">
                                        <p:menuitem icon="fa fa-check" styleClass="kbtn-info text-white" value="#{msg.edit}" immediate="true" action="#{purchaseController.editPurchase(purchase)}" update=":mainPanel"/>
                                        <p:menuitem icon="fa fa-check" styleClass="kbtn-info text-white" value="#{msg.payment} " immediate="true" action="#{purchaseController.purchasePayment(purchase)}" update=":mainPanel"/>
                                        <p:menuitem icon="fa fa-remove" styleClass="kbtn-danger text-white" value="#{msg.delete}" action="#{purchaseController.deletePurchase(purchase)}"  update="@form"/>
                                    </p:menuButton>
                                </p:column>
                            </p:dataTable>
                        </h:form>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{purchaseController.formView.createView}">
                        <div class="col-md-10 mx-auto">
                            <h:form class="mb-3 k-card">
                                <h:panelGrid columns="6" styleClass="spaced-form">

                                    <span class="required_field">#{msg.received_date}</span>
                                    <p:datePicker value="#{purchaseController.purchase.receivedDate}" pattern="#{msg.formatted_date}"
                                                  yearNavigator="true" monthNavigator="true"
                                                  required="true"/>

                                    <span>#{msg.purchase_type}</span>
                                    <p:selectOneMenu value="#{purchaseController.purchase.purchaseType}">
                                        <f:selectItem itemLabel="#{msg.choose}" />
                                        <f:selectItems value="#{sharedClass.purchaseTypeList}"/>
                                    </p:selectOneMenu>

                                    <span>#{msg.customer}</span>
                                    <p:selectOneMenu value="#{purchaseController.purchase.customer}" 
                                                     filter="true" filterMatchMode="contains" required="true">
                                        <f:selectItem itemLabel="#{msg.choose}"/>
                                        <f:selectItems value="#{commonClass.customerList}"/>
                                    </p:selectOneMenu>

                                    <span>#{msg.receipt_no}</span>
                                    <p:inputText value="#{purchaseController.purchase.receiptNo}"/>

                                    <span>#{msg.account}</span>
                                    <p:selectOneMenu value="#{purchaseController.purchase.account}">
                                        <f:selectItem itemLabel="#{msg.choose}"/>
                                        <f:selectItems value="#{commonClass.accountList}" />
                                    </p:selectOneMenu>

                                    <span>#{msg.payment_method}</span>
                                    <p:selectOneMenu value="#{purchaseController.purchase.paymentMethod}">
                                        <f:selectItem itemLabel="#{msg.choose}"/>
                                        <f:selectItems value="#{sharedClass.paymentMethodList}" />
                                    </p:selectOneMenu>
                                    
                                    <span>#{msg.total_amount}</span>
                                    <p:inputText value="#{purchaseController.purchase.totalAmount}"/>
                                </h:panelGrid>

                            </h:form>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mx-auto">
                                <fieldset>
                                    <legend class="text-info">Add Items</legend>
                                    <ui:include src="includes/purchase-item.xhtml"/>
                                </fieldset>
                            </div>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{purchaseController.formView.detailView}">
                         <ui:include src="includes/purchase-payment.xhtml"/>
                    </h:panelGroup>
                </h:panelGroup>

            </ui:define>
        </ui:composition>
    </h:body>
</html>

